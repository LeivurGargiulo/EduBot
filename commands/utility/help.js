/**
 * Help Command - Utility Category
 * Provides guidance on bot setup and usage
 */

const { SlashCommandBuilder, EmbedBuilder } = require('discord.js');
const embedStrings = require('../../data/embedStrings');

module.exports = {
    data: new SlashCommandBuilder()
        .setName('ayuda')
        .setDescription('Muestra informaci√≥n de ayuda sobre el bot y su configuraci√≥n')
        .addStringOption(option =>
            option.setName('tema')
                .setDescription('Tema espec√≠fico sobre el que necesitas ayuda')
                .setRequired(false)
                .addChoices(
                    { name: 'üìã Configuraci√≥n Inicial', value: 'setup' },
                    { name: 'üéüÔ∏è Sistema de Soporte', value: 'support' },
                    { name: 'üìö Comisiones y Cursos', value: 'courses' },
                    { name: 'üîß Comandos de Administraci√≥n', value: 'admin' },
                    { name: 'üë• Comandos de Comunidad', value: 'community' }
                )),
    
    cooldown: 30,

    /**
     * Execute the help command
     * @param {ChatInputCommandInteraction} interaction 
     */
    async execute(interaction) {
        const topic = interaction.options.getString('tema');

        if (topic === 'setup') {
            await showSetupHelp(interaction);
        } else if (topic === 'support') {
            await showSupportHelp(interaction);
        } else if (topic === 'courses') {
            await showCoursesHelp(interaction);
        } else if (topic === 'admin') {
            await showAdminHelp(interaction);
        } else if (topic === 'community') {
            await showCommunityHelp(interaction);
        } else {
            await showGeneralHelp(interaction);
        }
    }
};

/**
 * Show general help information
 */
async function showGeneralHelp(interaction) {
    const embed = new EmbedBuilder()
        .setTitle('ü§ñ Bot de Educaci√≥n - Ayuda General')
        .setDescription('¬°Bienvenido al bot educativo! Aqu√≠ tienes informaci√≥n sobre las diferentes funcionalidades disponibles.')
        .setColor(embedStrings.colors.primary)
        .addFields(
            {
                name: 'üìã Configuraci√≥n Inicial',
                value: 'Configura los canales, roles y sistemas b√°sicos del bot',
                inline: true
            },
            {
                name: 'üéüÔ∏è Sistema de Soporte',
                value: 'Configura y usa el sistema de tickets de soporte',
                inline: true
            },
            {
                name: 'üìö Comisiones y Cursos',
                value: 'Gestiona cursos, comisiones y materiales educativos',
                inline: true
            },
            {
                name: 'üîß Comandos de Administraci√≥n',
                value: 'Herramientas para administradores y moderadores',
                inline: true
            },
            {
                name: 'üë• Comandos de Comunidad',
                value: 'Funciones para todos los miembros del servidor',
                inline: true
            },
            {
                name: 'üõ†Ô∏è Comandos de Utilidad',
                value: 'Herramientas √∫tiles para el d√≠a a d√≠a',
                inline: true
            }
        )
        .addFields({
            name: 'üí° ¬øC√≥mo obtener ayuda espec√≠fica?',
            value: 'Usa `/ayuda tema:[tema]` para obtener informaci√≥n detallada sobre un tema espec√≠fico.\n\nEjemplos:\n‚Ä¢ `/ayuda tema:setup` - Configuraci√≥n inicial\n‚Ä¢ `/ayuda tema:support` - Sistema de soporte\n‚Ä¢ `/ayuda tema:courses` - Comisiones y cursos'
        })
        .setFooter({ text: 'Bot Educativo ‚Ä¢ Sistema de Ayuda' })
        .setTimestamp();

    await interaction.reply({ embeds: [embed] });
}

/**
 * Show setup help information
 */
async function showSetupHelp(interaction) {
    const embed = new EmbedBuilder()
        .setTitle('üìã Configuraci√≥n Inicial del Bot')
        .setDescription('Gu√≠a paso a paso para configurar el bot correctamente.')
        .setColor(embedStrings.colors.info)
        .addFields(
            {
                name: '1Ô∏è‚É£ Configurar Canales Base',
                value: '```/configuracion bot canales moderacion:#canal-moderacion soporte:#canal-soporte```\nEsto configura los canales para logs de moderaci√≥n y tickets de soporte.',
                inline: false
            },
            {
                name: '2Ô∏è‚É£ Configurar Roles de Staff',
                value: '```/configuracion roles staff staff:@RolStaff```\nEsto configura el rol que tendr√° acceso a comandos administrativos.',
                inline: false
            },
            {
                name: '3Ô∏è‚É£ Configurar Sistema de Verificaci√≥n',
                value: '```/configuracion roles verificacion canal:#verificacion rol-verificado:@Verificado activar:true```\nEsto activa el sistema de verificaci√≥n autom√°tica.',
                inline: false
            },
            {
                name: '4Ô∏è‚É£ Agregar Cursos',
                value: '```/agregar-curso codigo:MB nombre:"Maquetado Web B√°sico"```\nAgrega los cursos que se impartir√°n en el servidor.',
                inline: false
            },
            {
                name: '5Ô∏è‚É£ Crear Comisiones',
                value: '```/crear-comision codigo:MB-01```\nCrea las comisiones para cada curso usando el formato CURSO-N√öMERO.',
                inline: false
            }
        )
        .addFields({
            name: '‚úÖ Verificar Configuraci√≥n',
            value: 'Usa `/configuracion ver` para ver el estado actual de toda la configuraci√≥n.'
        })
        .setFooter({ text: 'Bot Educativo ‚Ä¢ Configuraci√≥n Inicial' })
        .setTimestamp();

    await interaction.reply({ embeds: [embed] });
}

/**
 * Show support system help
 */
async function showSupportHelp(interaction) {
    const embed = new EmbedBuilder()
        .setTitle('üéüÔ∏è Sistema de Soporte - Configuraci√≥n y Uso')
        .setDescription('Gu√≠a completa para configurar y usar el sistema de tickets de soporte.')
        .setColor(embedStrings.colors.success)
        .addFields(
            {
                name: 'üîß Configuraci√≥n del Sistema',
                value: '**Paso 1:** Configurar el canal de soporte\n```/configuracion bot canales soporte:#soporte```\n\n**Paso 2:** Configurar el rol de staff\n```/configuracion roles staff staff:@StaffSoporte```',
                inline: false
            },
            {
                name: 'üé´ Crear un Ticket',
                value: 'Los usuarios pueden crear tickets usando:\n```/soporte categoria:dudas_cursos descripcion:Mi consulta aqu√≠```\n\n**Categor√≠as disponibles:**\n‚Ä¢ ‚ùì Dudas sobre Cursos\n‚Ä¢ ‚öôÔ∏è Ayuda T√©cnica\n‚Ä¢ üë§ Reportar a un usuario\n‚Ä¢ üí° Sugerencias\n‚Ä¢ ‚ûï Otro',
                inline: false
            },
            {
                name: 'üîí Gestionar Tickets',
                value: '‚Ä¢ Los tickets se crean como hilos privados\n‚Ä¢ Solo el staff y el usuario pueden ver el ticket\n‚Ä¢ Usa el bot√≥n "Cerrar Ticket" para archivar el hilo\n‚Ä¢ Los tickets se crean autom√°ticamente en el canal configurado',
                inline: false
            },
            {
                name: '‚ö†Ô∏è Soluci√≥n de Problemas',
                value: '**Error:** "El sistema de soporte no est√° configurado"\n**Soluci√≥n:** Ejecuta los comandos de configuraci√≥n mencionados arriba.\n\n**Error:** "El canal de soporte configurado no existe"\n**Soluci√≥n:** Verifica que el canal existe y el bot tiene permisos.',
                inline: false
            }
        )
        .setFooter({ text: 'Bot Educativo ‚Ä¢ Sistema de Soporte' })
        .setTimestamp();

    await interaction.reply({ embeds: [embed] });
}

/**
 * Show courses help information
 */
async function showCoursesHelp(interaction) {
    const embed = new EmbedBuilder()
        .setTitle('üìö Sistema de Comisiones y Cursos')
        .setDescription('Gu√≠a para gestionar cursos, comisiones y materiales educativos.')
        .setColor(embedStrings.colors.maquetado1)
        .addFields(
            {
                name: 'üìù Agregar un Curso',
                value: '```/agregar-curso codigo:MB nombre:"Maquetado Web B√°sico"```\n\n**Formato del c√≥digo:** Solo letras may√∫sculas (ej: MB, JS, PY)',
                inline: false
            },
            {
                name: 'üèóÔ∏è Crear una Comisi√≥n',
                value: '```/crear-comision codigo:MB-01```\n\n**Formato:** CURSO-N√öMERO (ej: MB-01, JS-02, PY-01)\n\n**Se crean autom√°ticamente:**\n‚Ä¢ Rol de la comisi√≥n\n‚Ä¢ Canal de texto general\n‚Ä¢ Canal de anuncios\n‚Ä¢ Canal de charla libre\n‚Ä¢ Canal de voz',
                inline: false
            },
            {
                name: 'üë• Inscribir Estudiantes',
                value: 'Los estudiantes se inscriben usando:\n```/anotarse```\n\nEl bot buscar√° su informaci√≥n en la base de datos y les asignar√° el rol correspondiente.',
                inline: false
            },
            {
                name: 'üìñ Materiales de Curso',
                value: '```/material curso:MB```\n\nMuestra los materiales disponibles para el curso especificado.',
                inline: false
            },
            {
                name: 'üìä Ver Informaci√≥n',
                value: '```/mi-curso``` - Ver tus cursos inscritos\n```/listar-comisiones``` - Listar todas las comisiones\n```/listar-cursos``` - Listar todos los cursos',
                inline: false
            }
        )
        .setFooter({ text: 'Bot Educativo ‚Ä¢ Sistema de Cursos' })
        .setTimestamp();

    await interaction.reply({ embeds: [embed] });
}

/**
 * Show admin help information
 */
async function showAdminHelp(interaction) {
    const embed = new EmbedBuilder()
        .setTitle('üîß Comandos de Administraci√≥n')
        .setDescription('Herramientas disponibles para administradores y moderadores.')
        .setColor(embedStrings.colors.warning)
        .addFields(
            {
                name: '‚öôÔ∏è Configuraci√≥n',
                value: '```/configuracion``` - Configuraci√≥n unificada del bot\n```/status``` - Ver estado del bot y configuraci√≥n',
                inline: false
            },
            {
                name: 'üìö Gesti√≥n de Cursos',
                value: '```/agregar-curso``` - Agregar nuevo curso\n```/crear-comision``` - Crear nueva comisi√≥n\n```/listar-cursos``` - Ver todos los cursos\n```/listar-comisiones``` - Ver todas las comisiones',
                inline: false
            },
            {
                name: 'üëÆ Moderaci√≥n',
                value: '```/expulsar``` - Expulsar usuario\n```/silenciar``` - Silenciar usuario\n```/reportar``` - Reportar usuario',
                inline: false
            },
            {
                name: 'üì¢ Comunicaci√≥n',
                value: '```/normas``` - Enviar panel de normas\n```/presentarme``` - Enviar gu√≠a de presentaci√≥n\n```/recordatorio``` - Crear recordatorios',
                inline: false
            },
            {
                name: 'üîê Verificaci√≥n',
                value: '```/enviar-verificacion``` - Enviar mensaje de verificaci√≥n',
                inline: false
            }
        )
        .setFooter({ text: 'Bot Educativo ‚Ä¢ Comandos de Administraci√≥n' })
        .setTimestamp();

    await interaction.reply({ embeds: [embed] });
}

/**
 * Show community help information
 */
async function showCommunityHelp(interaction) {
    const embed = new EmbedBuilder()
        .setTitle('üë• Comandos de Comunidad')
        .setDescription('Funciones disponibles para todos los miembros del servidor.')
        .setColor(embedStrings.colors.info)
        .addFields(
            {
                name: 'üéì Educaci√≥n',
                value: '```/anotarse``` - Inscribirse en cursos\n```/material``` - Ver materiales de curso\n```/mi-curso``` - Ver tus cursos inscritos',
                inline: false
            },
            {
                name: 'üéüÔ∏è Soporte',
                value: '```/soporte``` - Crear ticket de soporte\n```/feedback``` - Enviar feedback',
                inline: false
            },
            {
                name: 'üëã Presentaci√≥n',
                value: '```/hola``` - Saludar al bot\n\nLos administradores pueden usar:\n```/presentarme``` - Enviar gu√≠a de presentaci√≥n',
                inline: false
            },
            {
                name: 'üìã Informaci√≥n',
                value: '```/ayuda``` - Ver esta gu√≠a de ayuda\n```/inscripciones``` - Informaci√≥n sobre inscripciones',
                inline: false
            }
        )
        .setFooter({ text: 'Bot Educativo ‚Ä¢ Comandos de Comunidad' })
        .setTimestamp();

    await interaction.reply({ embeds: [embed] });
} 